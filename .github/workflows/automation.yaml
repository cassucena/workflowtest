name: Azure Automation Deployment
on:
  push:
    branches:
      - main  
jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Azure Login
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }} # principal json information in Action Secrets

    - name: Deploy to Azure Automation
      run: |
        for file in ./*.py; do
          runbook_name=$(basename "$file" .py)
          az automation runbook publish --resource-group "teste" --automation-account "workflow" --name "$runbook_name" --content "$file" --no-wait
        done

        for file in ./*.ps1; do
          runbook_name=$(basename "$file" .ps1)
          az automation runbook publish -resource-group "teste" --automation-account "workflow" --name "$runbook_name" --content "$file" --no-wait
        done
